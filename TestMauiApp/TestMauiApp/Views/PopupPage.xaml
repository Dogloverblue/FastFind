<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="TestMauiApp.Views.PopupPage"
    Shell.NavBarIsVisible="false"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Keyboard-Selectable Buttons">

    <ContentPage.Resources>
        <!-- Selected/Normal colors -->
        <Color x:Key="ItemNormalBg">#202020</Color>
        <Color x:Key="ItemSelectedBg">#2E5AEF</Color>
        <Style TargetType="Grid" x:Key="ItemRoot">
            <Setter Property="Padding" Value="10,2" />
            <Setter Property="Margin" Value="0,2" />
            <Setter Property="BackgroundColor" Value="{StaticResource ItemNormalBg}" />
            <!-- <Setter Property="GestureRecognizers">
                <Setter.Value>
                   <GestureRecognizerCollection>
                        <TapGestureRecognizer Command="{Binding BindingContext.ItemTappedCommand, Source={x:Reference RootPage}}" CommandParameter="{Binding .}" />
                    </GestureRecognizerCollection> -
                </Setter.Value>
            </Setter> -->
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Margin="0,-60,0,0" x:Name="RootPage" Padding="20" BackgroundColor="#100900">
        <!-- Centered text input -->
        <Grid RowDefinitions="Auto" HorizontalOptions="Center" Margin="0,16,0,12">
            <Entry
                x:Name="CentralEntry"
                TextChanged="CentralEntry_TextChanged"
                WidthRequest="420"
                HorizontalOptions="Center"
                Placeholder="Type here..."
                Text="{Binding CentralText, Mode=TwoWay}" />
        </Grid>

        <!-- Vertical “buttons” list -->
        <CollectionView
            Grid.Row="1"
            x:Name="OptionsList"
            SelectionMode="Single"
            ItemsSource="{Binding Items}"
            SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
            SelectionChanged="OptionsList_SelectionChanged"
            VerticalOptions="Start"
            >
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="0" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <!--
                      Grid trick to keep the label centered relative to the full row:
                      - Put the Label in ColumnSpan=2 and center it
                      - Put the Image in Column 0 (Auto)
                    -->
                    <Grid
                        
                        Style="{StaticResource ItemRoot}"
                        ColumnDefinitions="Auto,*"
                        >
                        <!-- Background change on selection -->
                        <Grid.Triggers>
                            <DataTrigger TargetType="Grid" Binding="{Binding IsSelected}" Value="True">
                                <Setter Property="BackgroundColor" Value="{StaticResource ItemSelectedBg}" />
                            </DataTrigger>
                        </Grid.Triggers>

                        <!-- Left icon -->
                        <Image
                            Grid.Column="0"
                            Source="{Binding Icon}"
                            WidthRequest="22"
                            HeightRequest="22"
                            VerticalOptions="Center"
                            Margin="4,0,12,0"
                            />

                        <!-- Centered label spanning both columns -->
                        <Label
                            Grid.Column ="1"
                            Text="{Binding Title}"
                            HorizontalOptions="Start"
                            VerticalOptions="Center"
                            FontSize="16"
                            TextColor="White"
                            />
                        <Button Grid.Column="2"
                                FontSize="18"
                                HorizontalOptions="End"
                                 BackgroundColor="#005B5B58"
                            Text="📂" 
                                Clicked="OnItemButtonClicked">
                        </Button>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>